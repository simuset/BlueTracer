% !TEX root = LMThesisNicchi.tex

\chapter{Conclusions} \label{conclusion}

\vspace{-0.6cm}
In order to deal with the astounding amount of malware instances surfacing every day, there has been in recent years a shift towards the use of dynamic malware analysis techniques over static ones. A popular dynamic analysis strategy is function call monitoring, as it enables the analyst to grasp the behavior of the malware sample under analysis, despite the presence of code obfuscations. Such technique is normally implemented via API hooking, that is, the interception of functions exported by dynamically linked libraries (DLL). However, API hooking has to face the growing trend of evasive malware strains, which conceal their damaging behavior when under the magnifying glass of an analyst. Furthermore, most of the current API hooking techniques presented in literature do not provide adequate countermeasures against evasive malware.

Motivated by this realization, in this thesis we have developed BlueTracer, a robust library and system call tracer for Windows applications specialized in evasive malware, which was implemented adopting the Intel Pin dynamic binary instrumentation framework and is capable of remaining hidden thanks to its integration with the BluePill stealthy execution toolkit. During the tool's development, a notable implementation challenge was posed by the heterogeneity of Windows libraries employed by malware and by the lack of appropriate documentation regarding their prototypes. This was addressed by integrating information from a variety of reliable sources (two industry projects: Dr. Memory and CISCO Pyrebox), enabling the tool to support the correct tracing of more than 17,000 APIs. Moreover, a significant engineering effort had to be made in order to solve some of Intel Pin's inherent limitations which we encountered along the way.

Finally, the tests conducted on the Al-Khaser anti-malware system stress tool and on real evasive samples collected by Joe Security confirmed BlueTracer's ability to provide extensive and informative logs while, at the same time, remaining undetected.    

\section{Future Directions}

The obvious next step in BlueTracer's development is to test it with larger a set of highly-evasive malware samples, in order to further evaluate its effectiveness in a real-life scenario.

A lot has to still be done in order to further improve BlueTracer's logging capabilities. In fact, the tool's ability to log the contents of complex data structures such as \texttt{structs} and \texttt{unions} is still limited and needs to be worked on. Also, the tracer does not deal with complex scenarios where there are dependencies between parameters, i.e., the type of a parameter depends on the value of another parameter. In addition, we should be able to find a way to print the arguments values for user-mode callbacks and Windows Asychronous Procedure Calls by unpacking the data structures they receive as input. On top of that, BlueTracer, as of right now, supports only 32-bit Windows operating systems and, in light of this, we would like to extend its support for 64-bit versions. It is worth noting that the tool was only tested with Windows 7, so it might be also a good a idea to evaluate it when running in other versions of the Windows operating system, even though this should not impact BlueTracer's functionalities.

Another future direction regarding BlueTracer might be the application of Big Data algorithms to the logs it produces. In fact, due to the wealth of information being recorded, the logs produced by BlueTracer are often very large (up to tens of gigabytes), making it challenging to extract valuable insights from them. In the specific case of BlueTracer, the information of interest is represented by the set of malicious and anti-analysis actions performed by malware. As a result of this, it might be a good idea to applying Big Data analytics to isolate just the relevant information and to even compare and integrate the data coming from different logs, thus making the analyst's life easier.

\iffalse
Two areas:
\begin{enumerate}
\item Tools capabilities: support for struct, compatibility extension, more malwares tested
\item Data Analysis Techniques: data analysis for threat intelligence to analyze the logs.
\end{enumerate}
\fi