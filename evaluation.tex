% !TEX root = LMThesisNicchi.tex

\chapter{Experimental Evaluation}

In this chapter we will illustrate the results obtained during the experimental evaluation of BlueTracer.

We first tested the tool on a set of benign applications performing different tasks, in order to assess its run-time overhead.

Then, we validated BlueTracer using \textit{Al-Khaser} \cite{AlK}, a popular open-source project employed to assess how stealthy a malware analysis system is with respect to a large portion of public evasion techniques used by real malware families.

\iffalse
Finally, we employed BlueTracer to analyze a group of highly evasive real malware samples collected by Joe Security, the proclaimed technology leader for the analysis of evasive malware.
\fi

\iffalse
If JoeBox added differentiate machines
\fi
All the tests were conducted on a VirtualBox (version 5.2.6)  Virtual Machine with 1 CPU core and 3 GB of RAM running Windows 7 32-bit. The specifications of the host machine are:
\begin{itemize}
\item \textbf{Operating System:} Linux Mint 17.3 
\item \textbf{Processor:} Intel Core i7-3537U CPU @ 2.00 GHz $\times$ 2
\item \textbf{RAM:} 8 GBs  
\end{itemize}
 

\section{Run-Time Overhead Assessment}

In order to evaluate the overhead at run-time introduced by BlueTracer we tested it with a number of benign applications exercising a large number of functions. In order to experiment with a wide range of different functionalities, we picked a set of well-known Windows applications performing a variety of jobs. We grouped these applications based on the task they carry out, as shown below:

\begin{itemize}
\item \textbf{Collection of system information}
	   \begin{itemize}
	   \item \texttt{Systeminfo.} Outputs a summary of OS-environment parameters. 
	   \item \texttt{System File Checker (SFC).} Scans for corruptions in system files.
	   \item \texttt{Check Disk}. Checks the disks' integrity.
	   \item \texttt{IPConfig}. Displays TCP/IP network configuration values.
	   \item \texttt{Netstat}. Allows to display active TCP connections as well as TCP and UDP ports on which the computer is listening.
	   \item \texttt{Driver Query}. Shows a list of installed drivers and their properties.
	   \item \texttt{Windows Assessment Tools (WinSAT).} Measures a number of performance characteristics and reports them.
	   \item \texttt{Powercfg.} Enables to search for common energy-efficiency problems. 
	   \end{itemize}
\item \textbf{Compression programs}
		\begin{itemize}
		\item \texttt{7zip.} Default output extension is \texttt{.7z}.
		\item \texttt{IZArc.} Default output extension is \texttt{.zip}.
		\item \texttt{WinRar.} Default output extension is \texttt{.rar}.
		\end{itemize}
\item \textbf{Encryption Utilities}
		\begin{itemize}
		\item \texttt{Cipher.} Uses Encrypting File System (ESF), based on DESX. 
		\item \texttt{OpenSSL.} Was configured to employ 256-bit CBC AES.
		\item \texttt{Crypt.} Adopts RC2 block encryption.
		\end{itemize}
\item \textbf{Hashing Utilities}
		\begin{itemize}
		\item \texttt{File Checksum Integrity Verifier (FCIV).} Was set to use both MD5 and SHA1.
		\item \texttt{TurboSFV.} Was configured to adopt SHA3-224. 
		\end{itemize}
\end{itemize}

We first recorded the native execution time for each of the aforementioned applications. Then, we ran them under BlueTracer, logging the respective execution times. Specifically, the following BlueTracer modes of operation were employed:

\begin{itemize}
\item \textbf{Empty Image:} All image notification functions are empty, that is, they just increase a global counter value. This means that no analysis routines are inserted. 
\item \textbf{Empty Routine:} All analysis routines are empty, i.e., all they do is, once again, increase a global counter value.
\item \textbf{Main Image:} Only Native APIs and APIs being directly invoked from the main executable of the pinned application are traced. This is BlueTracer's default mode of operation. 
\item \textbf{Complete:} Every event is traced, including also Native APIs and APIs not being directly invoked from the main executable.
\end{itemize}

We executed every benign application in the previous page adopting each of the above operation modes, which can be set using BlueTracer's configuration file. Essentially, \textbf{Empty Image} and \textbf{Empty Routine} were utilized to determine the run-time overhead introduced just by the Pin's framework, when no analysis is actually performed. On the contrary, \textbf{Main Image} was adopted to show BlueTracer's overhead during a typical use of the tool, as \textbf{Main Image} is BlueTracer's default mode. Lastly, \textbf{Complete} was employed to determine how BlueTracer's behaves under heavy stress conditions.

We tested each application three times and then recorded the average execution time. For the compression programs, the file being compressed is the Puppy Linux ISO (\texttt{xenialpup-7.5-uefi.iso}), of size 332 MBs. On the other hand, for the encryption and hashing utilities, we used the Ubuntu 18.04 ISO (\texttt{ubuntu-18.04-desktop-amd64}), the size of which is 1.8 GBs. Add threshhold.       

The recorded execution times can be observed from table, which show how, as more analysis is carried out, the run-time increases.

Also in order to quantify the run-time overhead we used this and that.

\iffalse
Empty Image and Empty Routine to assess Pin's overhead
Main Image to assess analysis overhead in a typical scenario
Complete to stress
\fi

\iffalse
-Applications -> Mention Crypt and Compression files used
-Mention three times and then average
-Native vs Main and so on
-Mention that execution interrupted beforehand if, after 10 minutes, log size exceed a treshhold, e.g. 5 gb.
\fi

\vspace*{0.8cm}
\begin{sidewaystable}
\centering
%\begin{tabular}{cccccc}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcommand{\specialcell}[2][c]{%
  \begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}
\begin{tabularx}{\linewidth}{*{6}{Y}}

\hline
\hline
\cline{1-2}
   \textbf{Application} & \specialcell{ \textbf{Native} \\ \textbf{(s)}} & \specialcell{ \textbf{Empty Image} \\ \textbf{(s)}} & \specialcell{ \textbf{Empty Routine} \\ \textbf{(s)}} & \specialcell{ \textbf{Main Image} \\ \textbf{(s)}} & \specialcell{ \textbf{Complete} \\ \textbf{(s)}} \\
\hline
\texttt{Systeminfo}      & 5.894    & 9.686  & 12.869 & 15.694 & 26.398     \\
\texttt{SFC}          & 218.251 & 222.065 & 226.125 & 230.869 & 245.476       \\
\texttt{Check Disk}       & 101.570     & 171.94 & 181.429 & 454.649 & 600+      \\
\texttt{IPConfig}       & 0.105     & 4.257 & 8.421 & 9.599 & 13.181      \\
\texttt{Netstat} & 0.085 & 2.563 & 4.630 & 6.902 & 21.129       \\
\texttt{DriverQuery} & 1.168 & 6.663 & 9.786 & 34.074 & 68.668      \\
\texttt{WinSat}       & 163.175     & 212.496 & 221.012 & 273.641 & 600+      \\
\texttt{PowerCFG} & 61.333      & 73.325 & 80.018 & 132.466 & 273.882       \\
\texttt{7zip}       & 175.526     & 212.000 & 225.091 & 227.985 & 233.792      \\
\texttt{IZArc}      & 30.920     & 52.878 & 56.631 & 61.066 & 65.770      \\
\texttt{WinRar} & 155.674 & 192.638 & 198.804 & 208.606 & 215.455      \\
\texttt{Cipher} & 0.028 & 1.817 & 3.787 & 4.435 & 5.064       \\
\texttt{OpenSSL} & 24.769 & 33.183 & 34.308 & 47.006 & 1524.763      \\
\texttt{Crypt} & 65.392 & 140.048 & 142.979 & 572.353 & 600+      \\
\texttt{FCIV} & 10.807 & 25.113 & 28.144 & 56.329 & 87.948       \\
\texttt{TurboSFV} & 34.412 & 57.705 & 62.639 & 66.439 & 74.657
\\
\hline
\end{tabularx}
\vspace{0.2cm}
\caption{Execution times of instrumented benign applications}

\end{sidewaystable}

\iffalse
\begin{table}
\centering
%\begin{tabular}{cccccc}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcommand{\specialcell}[2][c]{%
  \begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}
\begin{tabularx}{\linewidth}{*{4}{Y}}
\hline
\hline
\cline{1-2}
   \textbf{Application} & \specialcell{ \textbf{Complete} \\ \textbf{(s)}} & \textbf{Events} & \specialcell{ \textbf{Overhead / Event} \\ \textbf{(s)}} \\
\hline
\texttt{Systeminfo}      & 26.398    & 387 476      \\
\texttt{System File Checker}          & each        & 0.01       \\
\texttt{Check Disk}       & stuffed     & 92.50      \\
\texttt{IPConfig}       & stuffed     & 33.33      \\
\texttt{Netstat} & frozen      & 8.99       \\
\texttt{DriverQuery}       & stuffed     & 92.50      \\
\texttt{WinSat}       & stuffed     & 33.33      \\
\texttt{PowerCFG} & frozen      & 8.99       \\
\texttt{7zip}       & stuffed     & 92.50      \\
\texttt{IZArc}      & stuffed     & 33.33      \\
\texttt{WinRar} & frozen      & 8.99       \\
\texttt{Cipher} & frozen      & 8.99       \\
\texttt{OpenSSL}       & stuffed     & 92.50      \\
\texttt{Crypt}      & stuffed     & 33.33      \\
\texttt{FCIV} & frozen      & 8.99       \\
\hline
\end{tabularx}
\caption{Run-time overhead for benign applications}
\end{table}
\fi

\vspace*{0.8cm}
\begin{sidewaystable}
\centering
%\begin{tabular}{cccccc}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcommand{\specialcell}[2][c]{%
  \begin{tabular}[#1]{@{}c@{}}#2\end{tabular}}
\begin{tabularx}{\linewidth}{*{6}{Y}}

\hline
\hline
\cline{1-2}
   \textbf{Application} & \specialcell{ \textbf{Native} \\ \textbf{(s)}} & \specialcell{ \textbf{Complete} \\ \textbf{(s)}} & \textbf{Events} & \specialcell{ \textbf{Overhead per Event} \\  \textbf{($10^-5$ s)} }  \\
\hline
\texttt{Systeminfo}      & 5.894    & 26.398  & 387 476 & $5.291$    \\
\texttt{SFC}          & 218.251 & 245.476 & 333 781 & $8.156$ \\
\texttt{IPConfig}       & 0.105 & 13.181 & 94 313 & $13.864$      \\
\texttt{Netstat} & 0.085 & 21.129 & 542 649 & $3.878$       \\
\texttt{DriverQuery} & 1.168 & 68.668 & 1 735 859 & $3.860$            \\
\texttt{PowerCFG} & 61.333 & 273.882 & 4 497 247 & $4.726$       \\
\texttt{7zip}       & 175.526 & 233.792 & 146 578 & $39.751$      \\
\texttt{IZArc}      & 30.920 & 65.770 & 109 142 & $31.931$      \\
\texttt{WinRar} & 155.674 & 215.455 & 84 329 & $70.890$      \\
\texttt{Cipher} & 0.028 & 4.435 & 24 141 & $18.255$           \\
\texttt{OpenSSL} & 24.769 & 1524.763 & 57 410 809 & $2.613$                \\
\texttt{FCIV} & 10.807 & 87.948 & 725 133 &  $10.638$               \\
\texttt{TurboSFV} & 34.412 & 74.657 & 183 455 & $21.937$ 
\\
\hline
\end{tabularx}
\vspace{0.2cm}
\caption{Run-time overhead for benign applications}

\end{sidewaystable}

\section{Al-Khaser}

\iffalse
\section{JoeBox}
\fi